#!/bin/bash

set -euo pipefail

PROJECT=$(realpath ~/.project)
DEV=$(realpath ~/.dev)

case "$-" in
*i*)	INTERACTIVE="i" ;;
*)	    INTERACTIVE="" ;;
esac

if [[ "${1:-}" = "" ]]; then
    INTERACTIVE="i"
fi

docker run --hostname=php73 \
    --volume=${DEV}/php73/home:${HOME} \
    --volume=${HOME}/prog:${HOME}/prog \
    --mount type=tmpfs,destination=${PROJECT}/app/cache,tmpfs-mode=1777 \
    --mount type=tmpfs,destination=${HOME}/tmp,tmpfs-mode=1777 \
    --network=aircrmrestarted_default \
    -${INTERACTIVE:-}t php72:latest -c "sudo chmod 777 ${PROJECT}/app/cache; cd ${PROJECT};${*:-zsh -i}"
